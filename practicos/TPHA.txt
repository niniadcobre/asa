
  ####################
  #ASA - TUASSL 2017 #
  #HA - TP01	   #
  ####################

NOTAS PRELIMINARES: 
El práctico a continuación pretende aumentar la comprensión acerca de la
implementación de un cluster, a partir de la guía "Cluster from scratch" 
de Pacemaker. La guía puede ser complementada con el documento 
"Configuration Explained" provisto en el sitio de Clusterlabs. 
Fuente de documentación: http://clusterlabs.org/


PASOS PRELIMINARES: 
1. Configurar un hostname distinto para cada nodo. 
2. Cambiar la contraseña de root. 
3. Observar la configuración de los dispositivos de almacenamiento y sistemas 
   de archivos.
4. Cuál es el archivo que identifica la versión de Centos del sistema. 
5. Observe la configuración de red. 
6. ¿Utiliza systemd o init? 
7. ¿Cuál es el objetivo final del laboratorio? 

PREGUNTAS HASTA 2.4.2
1. ¿Comparable a qué software en Debian es yum?¿Comparable a qué software en Debian es rpm?
2. ¿Qué repositorios están configurados en cada nodo?
2. Chrony: ¿Qué comandos utiliza para iniciar y habilitar el servicio de NTP?
3. Chrony: ¿Cómo verifica que los nodos están efectivamente sincronizando con NTP? 
5. ¿Cómo verifica que determinado paquete ya se encuentra instalado?
6. ¿Cuál es la diferencia entre el método utilizado en 2.4.2 y el uso de ssh-key-gen y ssh-copy-id?
7. ¿Para qué sirven los comandos screen y nohup?¿Por qué podrían serle de utilidad?
8. Guarde el listado total de servicios corriendo hasta el momento. 


PREGUNTAS DESDE 2.5 HASTA 2.6.3
0. Guarde toda la salida de la instalación de paquetes propuesta en 2.5
1. Indique brevemente para qué sirve cada uno de los paquetes instaladoss en 2.5. 
   Obtenga la información usando comandos del sistema. 
2. Liste y OBSERVE el contenido de los paquetes instalados en la sección 2.5
3. ¿Existen nuevos servicios relacionados al software instalado en 2.5?
4. Una vez instalado el software de cluster ¿cómo puede verificar los nuevos servicios del sistema?
5. ¿Cuál es el objetivo del link simbólico creado en la sección 2.6.2?
6. En la sección 2.6 indica hacer cambios en el firewall. ¿Por qué 
   cree que es necesario?¿Cómo puede darse cuenta qué firewall se 
   encuentra en uso? ¿Qué puertos son requeridos para el cluster? 
7. Sobre el software pcs, en la sección 2.6.2: ¿Cuál es el shell de 
   la cuenta de usuario creada para los fines de pcs?¿Qué efecto 
   tiene dicho shell? ¿En qué momento se crea la cuenta hacluster?
   ¿Hay otros usuarios con ese shell definido?
8. En la sección 2.6.3 los comandos se ejecutan en un sólo nodo. 
   ¿Por qué? ¿Cuál es la función del comando pcs?
9. Guarde la salida del comando pcs cluster setup
8. Observe el archivo de configuración creado por pcs para Corosync. 
   ¿En qué momento se instaló Corosync?¿Cuál es su función?


Preguntas a partir de sección 3 y hasta 5.1 (no proceder con 5.2 aún 27/10)
1) Una vez iniciado los servicios de cluster con pcs verifique el 
   estado de los servicios involucrados con systemctl. Guarde las 
   salidas: observe errores e información provista por los servicios. 
   Sobre qué aspectos del cluster proveen información los servicios.
 
2) Reinicie los nodos y verifique que los servicios no se encuentran 
   en ejecución. Reinicie los servicios esta vez utilizando systemctl. 
3) Ejecute las verificaciones en las secciones 4.2 y 4.3 en ambos 
   nodos, observe diferencias. 
4) En la sección 4.3 identifique cada uno de los procesos hijos de 
   pacemakerd. Investigue su funcionalidad brevemente para entender 
   qué parte del cluster implementan. 
5) ¿A qué paquete pertenece el comando journalctl? ¿Los errores 
   pertenecen todos a STONITH?
6) Observe el log de Corosync

Preguntas a partir de 5.2 a 6.8 (inclusive)
1) Los recursos del cluster son la razón de ser del cluster. 
   Son los servicios altamente disponibles. Existen distintas 
   formas de definir los servicios y darle herramientas al 
   cluster para controlarlos. Investigue brevemente OCF, LSB y systemd. 
   ¿Estas formas de definir servicios tiene que ver sólo con el cluster? 
2) Ubique dentro de /usr/lib/ocf/resource.d/ el script 
   correspondiente a la IP configurada en 5.2. Observe brevemente su contenido,
   en particular las líneas finales que procesan la acción a realizar con el servicio. 
3) Observe el estado del cluster y la nueva IP configurada en la interfaz de red eth0 (comando ip). 
4) En la sección 5.3 antes de realizar el failover observe el estado del recurso creado, y mantenga un ping desde un lugar remoto para observar lo que sucede con el recurso. ¿Cuán apreciable es el tiempo de downtime del recurso?
5) ¿A qué recursos afecta el resource-stickiness configurado en 5.4?
6) Lea atentamente y comente la nota que dice "Important" en la sección 6.1. Verifique el estado del servicio httpd. 
7) Ubique y revise brevemente el script que utiliza el cluster para administrar el recurso apache en la sección 6.4. 
8) Una vez creado el recurso http (sección 6.4), OBSERVE en qué nodo se inició el recurso web y dónde se encuentra el recurso IP. 
9) ¿Qué sucedió con los recursos al establecer la restricción en la sección 6.5? ¿En qué otra situación los recursos se han migrado durante el transcurso de la guía?
10) Entre la sección 6.5 y 6.8 se establecen restricciones entre los recursos para lograr ciertos efectos. Una vez alcanzada la sección 6.8 revise nuevamente los efectos de cada uno de los pasos realizados a partir de 6.5 
11) Una vez completada la sección 6.8: realice un failover ida y vuelta, observando el tiempo de downtime del servicio http. 

Preguntas sección 7 
34) Observando restricción de orden: Reiniciar el recurso IP y observar el efecto sobre WebSite. 
35) Observar restricción de ubicación: Mover el recurso IP y observar el efecto
 sobre WebSite. 

36) Observar lo qué sucede en el cluster ante una situación de amnesia: 
Observar el cluster.
Detener uno de los nodos. 
Observar el cluster.
Detener el segundo nodo (forzar). 
Observar estado de IP y WebSite. 
Levantar el cluster en el primer nodo que se detuvo.
Observar el cluster.
Levantar el segundo nodo. Observar. 

37) Repetir anterior pero levantando primero el último nodo activo en el cluster.

38) Observe el contenido de los paquetes instalados en 7.1. ¿Qué provee cada uno?

39) Una vez configurado drbd, detener el cluster (ambos nodos) y migrar el dispositivo drbd manualmente (ida y vuelta). Probar montaje manual y escritura, en ambos nodos. DESMONTAR antes de iniciar el cluster nuevamente.


40) Además del puerto abierto para drbd (sección 7.1) ¿Qué otros puertos son requeridos para  el funcionamiento del cluster? Haga una lista. 

41) Observar la creación de los recursos en 7.6.¿Por qué cree necesario este tipo de recurso master/slave?¿Qué diferencia hay con cluster IP y Apache?

42) En la sección 7.7 se define el recurso que controla el sistema de archivos. ¿Quién controla el montaje del mismo? ¿Se montará el sistema de archivos durante el inicio del sistema?

43) Revise el documento: Pacemaker 1.1 Configuration Explained. ¿Qué información provee? 



