######################################
# ASA - 2019 - Almacenamiento - PARTE1
######################################

Dispositivos loop (bucle)
=========================
1) Crear un script que genere n archivos de un tamaño fijo, y los asocie a 
loop devices. El número de archivos y su tamaño deben recibirse como argumento
de entrada.  
    a) Agregue una opción al script anterior (digamos -p) tal que si se provee 
       dicha opción los archivos se particionen con MBR o GPT (-p M o -p G). 

    b) Agregue una opción -e (erase) al script anterior para que muestre un 
       listado de los loopdevices actualmente asociados y borre aquellos que 
       el usuario seleccione (considere el uso de la orden compuesta select). 
       No solo debe remover la asociación, sino que además debe eliminar el 
       archivo asociado. 

    c) Agregue una opción -E (ERASE) que elimine todos los loop devices y los 
       correspondientes archivos asociados. Debe mostrarse una advertencia y 
       confirmación antes de seguir.  

2) Utilice un loopdevice para visualizar el contenido de usa ISO. 


Tabla de particiones
====================
NOTA: los siguientes ejercicios están pensados para, en la medida de lo
posible, utilizar loopdevices de prueba y no arruinar el contenido de sus 
discos físicos. No utilice loopdevices demasiado pequeños, considere al 
menos unos 50Mb por disco. También es posible usar discos físicos pero 
tenga siempre presente que se realizan actividades que pueden MUY probablemente
dañar los datos (solo los datos).  

1) Para cada una de las siguientes herramientas: fdisk, parted, gparted,cgdisk/gdisk/sgdisk. 
   a) Crear, listar y destruir tablas de particiones (elija el tipo). 
   b) ¿Es gráfica y/o línea de comandos? 
   c) ¿A qué paquete de software pertenece? 
   d) ¿Qué tipo de tabla de particiones soporta? 
   e) ¿Tiene opciones para trabajar con sistemas de archivos?

2) Reconocer tipos de particiones. Comprender la estructura de la tabla de 
   particiones. MBR/BIOS particiones primarias, extendidas y lógicas. UEFI/GPT.

   a) Crear en una tabla de particiones tipo msdos (IBM PC) sobre un dispositivo
   loop. Copiar la tabla de particiones a un archivo, destruir la tabla anterior
   y restaurarla. Escriba el procedimiento paso a paso. Observe el cambio del 
   contenido del dispositivo antes y después (hexdump, hd) 

   b) Crear una tabla de particiones tipo GPT. Destruir la tabla principal y 
   restaurarla del backup que la misma establece. Observe el cambio de contenido
   del dispositivo antes y después (hexdump,hd) 

3) Discuta ¿Qué relación existe entre GPT/UEFI - MBR/BIOS? ¿Diferencias? 


Sistemas de archivos:
=====================
Cada sistema de archivos es un software con características determinadas por 
las/los desarrolladores. Algunos estarán diseñados de una manera sencilla y 
mínima con muchas restricciones (FAT), otros serán más complejos para dar 
soporte a archivos grandes, etc. Analizaremos algunas características 
especiales para comenzar a distinguir entre las distintas implementaciones.  

Archivos prealojados/dispersos
------------------------------
Archivo prealojado: una aplicación necesita reservar espacio antes de usarlo
efectivamente (antes de tener los datos a escribir). Esto es crear las 
estructuras internas que representan al archivo dentro del sistema de archivos 
y, reservar los bloques.  Las opciones son escribir ceros o utilizar archivos 
dispersos provistos por el sistema de archivos. 

1) ¿Todos los sistemas de archivos implementan archivos dispersos?

2) ¿Cómo reconocer un archivo disperso? Observar los comandos du, ls y find. 

3) Crear un archivo de 100Mb utilizando fallocate, dd y truncate. Tomar 
los tiempos en cada caso (comando time) ¿Son archivos dispersos? 

4) ¿Qué sucede al realizar una copia de un archivo disperso?¿Qué sucede si 
hacemos la copia en un sistema de archivos que no implementa este tipo de
archivos? Haga la prueba. Indique el sistema de archivos de origen y destino. 

5) ¿Es posible crear un archivo disperso mayor al espacio libre en el sistema
de archivos? Realice el intento. 

6) ¿Es posible crear un archivo disperso mayor al tamaño total del sistema de 
archivos? Realice el intento. 

7) ¿Qué sistemas de archivos están soportados en su computadora? (man 
filesystems)¿Qué sucede si el sistema de archivos no se encuentra disponible?

8) ¿Qué tipos de re-dimensión de sistema de archivos se pueden realizar? ¿Qué
significa hacer re-dimensión en caliente?¿Todos los sistemas de archivos 
soportan estas características? Ejemplifique. 

9) Reproducir en una terminal paso a paso la secuencia de comandos presentada
en el apunte de cátedra para "Loop devices" (Configuraciones de almacenamiento)
Explique qué sucede en cada comando.  

10) Elija un sistema de archivos soportado en GNU/Linux, investigue y 
desarrolle una breve explicación de sus principales características. 
(Martes 20 de agosto). 

Dispositivos especiales
-----------------------
11) Investigue el funcionamiento del comando dd: 
   
  a) dd of=archivo if=/dev/zero bs=1k count=5120. Tome el tiempo (time).
  b) dd of=archivo if=/dev/urandom bs=1k count=5120. Tome el tiempo (time).
  c) dd of=archivo if=/dev/random bs=1k count=5120. Tome el tiempo (time).
  d) ¿Diferencia entre /dev/random y /dev/urandom? (man)
  e) top | dd of=archivo bs=1k count=5120
  f) dd of=archivo bs=1k seek=5120 count=0
   1) observe el contenido de cada archivo con od -c. ¿De dónde 
      proviene el contenido en cada caso? 
   2) ¿Son archivos dispersos?
   3) ¿Qué función cumple los modificadores bs seek y count?

12) Explique el efecto de la opción oflag=append y conv=notrunc de 
dd en la siguiente secuencia.
$ dd if=/dev/urandom of=archivo1 bs=1024k count=5 
$ dd if=/dev/urandom of=archivo1 bs=512 count=1 oflag=append conv=notrunc 
s
   a) ¿Qué tipo de archivo es archivo1? ¿Cuál es su contenido?
   b) ¿Qué tipo de archivo es /dev/urandom? ¿Para qué sirve? Compare con 
      /dev/zero. 
   c) ¿Qué sucede si repetimos n veces el segundo comando? 

